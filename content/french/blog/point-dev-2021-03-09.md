---
########## Hugo Variables ##########
# Page title (also title in web browsers and link previews if `linktitle` is not specified)
title: Point d√©veloppement ‚Äì 9 mars 2021
# Title in web browsers and link previews (optional)
linktitle: Point d√©veloppement ‚Äì 9 mars 2021 | Blog Monki Projects
# Page description: paragraph in web browsers and link previews
description: J'ai travaill√© sur beaucoup de choses diff√©rentes ces jours-ci, alors voici un petit r√©capitulatif de ce que j'ai fait et de ce qui demande encore du travail. C'est principalement de l'infrastructure et de l'automatisation, mais j'ai aussi travaill√© sur le site.
# Page summary: paragraph summarizing the page (e.g. in list cards)
summary: J'ai travaill√© sur beaucoup de choses diff√©rentes ces jours-ci, alors voici un petit r√©capitulatif de ce que j'ai fait et de ce qui demande encore du travail. C'est principalement de l'infrastructure et de l'automatisation, mais j'ai aussi travaill√© sur le site.
# Date assigned to the page
date: 2021-03-09T12:10:00+01:00
# Last modification date
lastmod: 2021-04-10T15:02:04.322+02:00
# Images in link previews
images:
  - https://res.cloudinary.com/monki-projects/image/upload/f_auto,w_auto/v1617994923/website/fr/uploads/articles/point-dev-2021-03-09/cover-light
# Page is a draft?
# - true: Page won't show in production, will show locally with `-D` option
# - false: Page will be visible (unless date in the future)
draft: false

##### Localization #####
# Translation key used for content localization (optional in default language)
# Value is the path to the content in the default language
# E.g. `blog/monki-map-from-2018-to-2020` is the translation key
# for French article `blog/monki-map-de-2018-a-2020`
translationKey: blog/dev-update-2021-03-09

########## Custom Variables ##########
# Article author (name of a file in `team/` or `authors/`)
author: remi-bardon
# Article cover in light and dark mode
cover:
  light: https://res.cloudinary.com/monki-projects/image/upload/f_auto,w_1024/v1617994923/website/fr/uploads/articles/point-dev-2021-03-09/cover-light
  dark: https://res.cloudinary.com/monki-projects/image/upload/f_auto,w_1024/v1617994923/website/fr/uploads/articles/point-dev-2021-03-0/cover-dark
---

## Site web

C'est toujours en d√©veloppement, mais j'ai pass√© plusieurs heures √† travailler sur deux grosses am√©liorations pour le site¬†:

1. **Mode sombre üòçüåö**

   √Ä chaque fois que je vais sur notre site la nuit, √ßa me br√ªle les yeux  üòµ En tant que d√©veloppeur, je sais √† quel point le mode sombre est important, et j'ai essay√© plusieurs techniques pour le configurer ici. Pour √©viter les FOIT ‚Äì¬†Flash Of Incorrect Theme¬†‚Äì (voir le [Guide Complet pour le Mode Sombre sur le Web de CSS-Tricks](https://css-tricks.com/a-complete-guide-to-dark-mode-on-the-web/#storing-preferences)), j'ai d√©cid√© de partir sur la version [CSS](https://fr.wikipedia.org/wiki/Feuilles_de_style_en_cascade) pur [au niveau du syst√®me d'exploitation](https://css-tricks.com/a-complete-guide-to-dark-mode-on-the-web/#os-level). Malheureusement, on utilise [Bootstrap](https://getbootstrap.com), qui ne supporte pas le mode sombre. Apr√®s de nombreux essais avec Bootstrap, et apr√®s avoir essay√© des alternatives comme [Halfmoon](https://css-tricks.com/halfmoon-a-bootstrap-alternative-with-dark-mode-built-in/), je n'ai pas r√©ussi √† trouver un bon √©quilibre entre simplicit√© et prise en compte du mode sombre.

   Comme on est toujours tr√®s occup√©s √† d√©velopper notre logique m√©tier, j'ai d√©cid√© de rester avec Boostrap, pour √©viter d'avoir √† r√©√©crire un th√®me CSS entier pour le site, mais en utilisant la surcharge de variables [SCSS](https://en.wikipedia.org/wiki/Sass_(stylesheet_language)) pour permettre le mode sombre. J'ai eu des probl√®mes, mais c'est en bon chemin.

2. ***Tags* üè∑**

   On n'a pas encore beaucoup d'articles, mais il nous faut quand m√™me des *tags* pour organiser les sujets. [Hugo](https://gohugo.io) propose des outils tr√®s utiles pour l'utilisation de *tags*, donc ce n'√©tait pas tr√®s difficile. C'est bient√¥t pr√™t, mais je le publierai en m√™me temps que le mode sombre.

## Redirection des GitHub Pages

T√¢che tr√®s simple, mais j'ai juste configur√© [GitHub Pages](https://pages.github.com/) pour rediriger [monkiprojects.github.io](https://monkiprojects.github.io) vers [docs.monkiprojects.com](https://docs.monkiprojects.com/).

> Cette partie est destin√©e √† des d√©veloppeurs(euses). Vous pouvez essayer de la lire sans l'√™tre, mais je ne vous promets pas que vous comprendrez üôÉ

## Sp√©cifications OpenAPI

J'ai pass√© beaucoup de temps √† am√©liorer le processus de d√©finition [OpenAPI](https://swagger.io/docs/specification/about/) pour en automatiser une grande partie. √Ä ce jour, voici ma *to-do list*¬†:

- [x] D√©finir des sp√©cifications OpenAPI pour chaque [API](https://fr.wikipedia.org/wiki/Interface_de_programmation) dans des [fichiers d√©di√©s](https://github.com/MonkiProjects/monki-projects-api-specs/blob/f81b8ab58b2cd6effd7541e731becaa5a44c7f86/specs)
- [ ] Simplifier et continuer de factoriser les sp√©cifications OpenAPI (les rendre plus lisibles)
- [x] [Fusionner les sp√©cifications OpenAPI](https://github.com/MonkiProjects/monki-projects-api-specs/blob/f81b8ab58b2cd6effd7541e731becaa5a44c7f86/merge.sh) en [un seul fichier](https://github.com/MonkiProjects/monki-projects-api-specs/blob/f81b8ab58b2cd6effd7541e731becaa5a44c7f86/specs/monki-projects-api-v1.yaml)
- [x] G√©nerer [l'interface Swagger UI pour les d√©finitions OpenAPI fusionn√©es](https://docs.monkiprojects.com/monki-projects-api-specs/)
- [ ] G√©nerer l'interface Swagger UI pour toutes les d√©finitions OpenAPI (fusionn√©es et s√©par√©es) en utilisant [le param√®tre `urls`](https://swagger.io/docs/open-source-tools/swagger-ui/usage/configuration/#core)

## Am√©liorations de l'API Monki Projects

En plus de d√©velopper la plupart des fonctionnalit√©s d√©finies par [la sp√©cification de l'API Monki Projects](https://github.com/MonkiProjects/monki-projects-api-specs/blob/f81b8ab58b2cd6effd7541e731becaa5a44c7f86/specs/monki-projects-api-v1.yaml), j'ai configur√© [SwiftLint](https://github.com/realm/SwiftLint), pour avoir un style de code uniforme et faire respecter les conventions de Swift, et [Sitrep](https://github.com/twostraws/Sitrep), pour analyser le code source.

J'ai aussi pass√© beaucoup de temps sur un bug bizarre de [Swift Package Manager](https://swift.org/package-manager/)‚Ä¶ qui venait d'un *patch* que j'avais fait il y a quelques mois ü§¶üèª‚Äç‚ôÇÔ∏è

## G√©n√©ration automatique des clients d'APIs

Les [APIs](https://fr.wikipedia.org/wiki/Interface_de_programmation) de Monki Projects sont, en grande partie, du code m√©tier (notre domaine). Nos applications et logiciels sont, en grande partie, du code m√©tier √©galement. Cependant, la communications entre les deux ne l'est pas. C'est pourquoi nous avons d√©cid√© de d√©finir des [sp√©cifications OpenAPI](https://swagger.io/docs/specification/about/) claires pour toutes nos APIs et d'automatiser la g√©n√©ration du code des clients dans tous les langages. Pour l'instant, on supporte seulement le [Swift](https://swift.org/about/) (car on n'a pas besoin des qutres langages pour l'instant), mais ce serait tr√®s simple de g√©n√©rer des clients dans de nombreux autres langages (tant qu'ils sont support√©s par [OpenAPI Generator](https://openapi-generator.tech/)).

> Le g√©n√©rateur de client Swift est toujours en d√©veloppement, donc le code qu'il g√©n√®re n'est pas aussi bien que ce que l'on voudrait (voir [OpenAPITools/openapi-generator#8901](https://github.com/OpenAPITools/openapi-generator/issues/8901), mais on va l'utiliser pour l'instant afin de gagner du temps, et on contribuera plus tard si besoin.

## Vues SwiftUI r√©utilisables

On d√©veloppe une application, sur iOS pour l'instant *(ne vous inqui√©tez pas, Android arrive derri√®re, c'est pourquoi on d√©pense autant d'√©nergie √† tout s√©parer et sp√©cifier)*, mais il y aura aussi des applications macOS et iPadOS. Ansi, on a besoin d'avoir des vues r√©utilisables pour rendre le d√©veloppement plus rapide et avoir une identit√© d'application de qualit√©. √áa facilitera aussi la maintenance, la lisibilit√© et permettra √† n'importe qui de r√©utiliser les vues de Monki Map (et toutes celles de Monki Projects par extension) dans leurs projets.

J'ai pass√© beaucoup de temps √† mettre en place l'architecture et l'automatisation mentionn√©s plus haut, donc l'application a d√ª √™tre mise en pause. Cependant, j'ai cr√©√© une petite application macOS en quelques heures *‚Äì vous voyez la puissance d'avoir bien d√©coup√© le code¬†? ‚Äì* qui permet √† quelqu'un de cr√©er un compte, se connecter, se d√©connecter, voir la liste des utilisateurs et la liste des lieux publi√©s/soumis √† v√©rification. C'√©tait juste un petit projet pour tester l'infrastructure (avec succ√®s) et pour trouver des probl√®mes (avec succ√®s aussi üò≠), c'est pourquoi il n'est pas encore sur GitHub.

## G√©neration automatique de diagrammes

Je suis quelqu'un de visuel, et je trouve que ces articles manquent de diagrammes et d'images. Pour rendre √ßa plus simple, j'ai d√©cid√© de scripter l'utilisation de [Kroki](https://kroki.io/) pour g√©n√©rer des diagrammes √† partir de leur repr√©sentation textuelle. √áa a l'avantage de permettre le versionnage (avec `git`) et a une tr√®s grande portabilit√© (puisque √ßa utilise des outils *Open-Source* avec des formats communs).

- [x] Utiliser [Kroki](https://kroki.io/) manuellement
- [x] Scripter la g√©n√©ration des diagrammes
- [x] Ajouter un [cache](https://fr.wikipedia.org/wiki/M%C3%A9moire_cache) pour √©viter la g√©n√©ration inutile de diagramme
  - [x] Stocker le [hachage des fichiers (SHA-256)](https://fr.wikipedia.org/wiki/Secure_Hash_Algorithm)
  - [x] Nettoyer le cache des hachages de fichiers d'entr√©e supprim√©s
  - [x] D√©tecter les fichiers de sortie supprim√©s (m√™me si le hachage du fichier d'entr√©e est dans le cache)
  - [x] Permettre les formats de sortie multiples (ex¬†: savoir que `diagram1.svg` est g√©n√©r√© mais pas `diagram1.png`)
- [x] Ajouter un vidage du cache en cas de probl√®me (option `-f` pour forcer la g√©n√©ration)
- [x] √âcrire une [documentation d'utilisation du script](https://github.com/MonkiProjects/monki-projects-api-specs/blob/f81b8ab58b2cd6effd7541e731becaa5a44c7f86/CONTRIBUTE.md#createupdate-diagrams)
- [ ] Permettre la g√©n√©ration en dehors de [monki-projects-api-specs](https://github.com/MonkiProjects/monki-projects-api-specs)
- [ ] Cr√©er un [`git` *hook*](https://git-scm.com/docs/githooks) / une [GitHub Action](https://github.com/features/actions) pour g√©n√©rer automatiquement les diagrammes lors d'un `git push`
- [ ] Prendre en charge les param√®tres du script proprement
